<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åŠ è½½ä¸­... - è›‹å°å¨æ–‡æ¡£</title>
  <meta name="description" content="è›‹å°å¨é¡¹ç›®æ–‡æ¡£">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --primary: #FF6B6B;
      --primary-light: #FF8E53;
      --bg: #F8F9FA;
      --text: #333333;
      --text-secondary: #666666;
      --border: #E8E8E8;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
    }
    
    .header {
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: white;
      padding: 20px;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .header-inner {
      max-width: 900px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .header-brand {
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
      color: white;
    }
    
    .header-brand:hover { opacity: 0.9; }
    .header-logo { font-size: 24px; }
    .header-title { font-size: 16px; font-weight: 600; }
    
    .header-actions { display: flex; gap: 10px; }
    
    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
    }
    .btn-light {
      background: rgba(255,255,255,0.2);
      color: white;
    }
    .btn-light:hover { background: rgba(255,255,255,0.3); }
    .btn-white {
      background: white;
      color: var(--primary);
    }
    .btn-white:hover { background: #f5f5f5; }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 30px 20px;
    }
    
    .doc-meta {
      background: white;
      border-radius: 12px;
      padding: 20px 24px;
      margin-bottom: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      border: 1px solid var(--border);
    }
    
    .doc-title {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 12px;
      color: var(--text);
    }
    
    .doc-info {
      display: flex;
      gap: 20px;
      font-size: 13px;
      color: var(--text-secondary);
    }
    
    .doc-info-item { display: flex; align-items: center; gap: 6px; }
    
    .doc-type-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }
    .doc-type-badge.prd { background: #E3F2FD; color: #1976D2; }
    .doc-type-badge.test { background: #FFF3E0; color: #F57C00; }
    .doc-type-badge.marketing { background: #F3E5F5; color: #7B1FA2; }
    .doc-type-badge.design { background: #E8F5E9; color: #388E3C; }
    .doc-type-badge.custom { background: #F5F5F5; color: #616161; }
    
    .doc-content {
      background: white;
      border-radius: 12px;
      padding: 40px 48px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      border: 1px solid var(--border);
    }
    
    /* Markdown æ ·å¼ */
    .markdown-body { font-size: 16px; line-height: 1.8; color: var(--text); }
    .markdown-body h1 { font-size: 26px; font-weight: 700; margin: 0 0 20px 0; padding-bottom: 12px; border-bottom: 2px solid var(--primary); }
    .markdown-body h2 { font-size: 22px; font-weight: 600; margin: 36px 0 16px 0; padding-bottom: 8px; border-bottom: 1px solid var(--border); }
    .markdown-body h3 { font-size: 18px; font-weight: 600; margin: 28px 0 12px 0; }
    .markdown-body h4 { font-size: 16px; font-weight: 600; margin: 24px 0 8px 0; }
    .markdown-body p { margin: 16px 0; }
    .markdown-body ul, .markdown-body ol { margin: 16px 0; padding-left: 24px; }
    .markdown-body li { margin: 8px 0; }
    .markdown-body blockquote {
      margin: 20px 0;
      padding: 16px 20px;
      background: linear-gradient(135deg, #FFF5F5, #FFF0F0);
      border-left: 4px solid var(--primary);
      border-radius: 0 8px 8px 0;
    }
    .markdown-body blockquote p { margin: 0; }
    .markdown-body code { background: #F5F5F5; padding: 2px 6px; border-radius: 4px; font-family: 'Monaco', 'Consolas', monospace; font-size: 14px; color: var(--primary); }
    .markdown-body pre { background: #1E1E1E; color: #D4D4D4; padding: 20px; border-radius: 8px; overflow-x: auto; margin: 20px 0; }
    .markdown-body pre code { background: none; padding: 0; color: inherit; font-size: 13px; }
    .markdown-body table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 14px; }
    .markdown-body th { background: #FAFAFA; padding: 12px 16px; text-align: left; font-weight: 600; border: 1px solid var(--border); }
    .markdown-body td { padding: 12px 16px; border: 1px solid var(--border); }
    .markdown-body tr:hover td { background: #FAFAFA; }
    .markdown-body hr { border: none; height: 1px; background: var(--border); margin: 32px 0; }
    .markdown-body strong { font-weight: 600; }
    .markdown-body a { color: var(--primary); text-decoration: none; }
    .markdown-body a:hover { text-decoration: underline; }
    
    .loading {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    
    .error {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }
    .error-icon { font-size: 48px; margin-bottom: 16px; }
    
    .footer {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-secondary);
      font-size: 13px;
    }
    .footer a { color: var(--primary); text-decoration: none; }
    .footer a:hover { text-decoration: underline; }
    
    .toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: #333;
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      opacity: 0;
      transition: all 0.3s;
      z-index: 2000;
    }
    .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
    .toast.success { background: #52C41A; }
    
    /* çº¯æ–‡æœ¬æ¨¡å¼ - ç»™AIè¯»å– */
    .plain-text-content {
      display: none;
    }
    
    @media (max-width: 768px) {
      .header-inner { flex-direction: column; gap: 12px; }
      .container { padding: 20px 16px; }
      .doc-content { padding: 24px; }
      .doc-title { font-size: 22px; }
      .doc-info { flex-wrap: wrap; gap: 12px; }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <a href="./" class="header-brand">
        <span class="header-logo">ğŸ¥š</span>
        <span class="header-title">è›‹å°å¨æ–‡æ¡£ä¸­å¿ƒ</span>
      </a>
      <div class="header-actions">
        <button class="btn btn-light" onclick="copyLink()">ğŸ”— å¤åˆ¶é“¾æ¥</button>
        <a href="./" class="btn btn-white">ğŸ“š å…¨éƒ¨æ–‡æ¡£</a>
      </div>
    </div>
  </header>
  
  <main class="container">
    <div id="loading" class="loading">
      <div class="loading-spinner"></div>
      <p>æ­£åœ¨åŠ è½½æ–‡æ¡£...</p>
    </div>
    
    <div id="error" class="error" style="display: none;">
      <div class="error-icon">ğŸ“„</div>
      <h2>æ–‡æ¡£ä¸å­˜åœ¨</h2>
      <p style="margin-top: 12px;">è¯¥æ–‡æ¡£å¯èƒ½å·²è¢«åˆ é™¤æˆ–é“¾æ¥æ— æ•ˆ</p>
      <a href="./" class="btn btn-white" style="margin-top: 20px; display: inline-block; background: var(--primary); color: white;">è¿”å›æ–‡æ¡£ä¸­å¿ƒ</a>
    </div>
    
    <div id="doc-container" style="display: none;">
      <div class="doc-meta">
        <h1 class="doc-title" id="doc-title"></h1>
        <div class="doc-info">
          <div class="doc-info-item" id="doc-folder-item" style="display: none;">
            <span>ğŸ“</span>
            <span id="doc-folder"></span>
          </div>
          <div class="doc-info-item">
            <span class="doc-type-badge" id="doc-type-badge"></span>
          </div>
          <div class="doc-info-item">
            <span>ğŸ“…</span>
            <span id="doc-date"></span>
          </div>
        </div>
      </div>
      
      <article class="doc-content">
        <div class="markdown-body" id="doc-body"></div>
      </article>
    </div>
  </main>
  
  <footer class="footer">
    <p>ğŸ¥š è›‹å°å¨ - ä¸“æ³¨è§£å†³æ¯å¤©åƒå•¥çš„ä¸–çºªéš¾é¢˜</p>
    <p style="margin-top: 8px;"><a href="./">è¿”å›æ–‡æ¡£ä¸­å¿ƒ</a></p>
  </footer>
  
  <!-- çº¯æ–‡æœ¬å†…å®¹åŒºåŸŸ - æ–¹ä¾¿AIè¯»å– -->
  <div class="plain-text-content" id="plain-text" aria-hidden="true"></div>
  
  <div class="toast" id="toast"></div>
  
  <script>
    var API_URL = 'https://cloud1-5gf9jz2m380b0685-1392482126.ap-shanghai.app.tcloudbase.com/docApi';
    var currentDoc = null;
    
    function $(id) { return document.getElementById(id); }
    
    function showToast(message, type) {
      var toast = $('toast');
      toast.textContent = message;
      toast.className = 'toast show ' + (type || '');
      setTimeout(function() { toast.classList.remove('show'); }, 2500);
    }
    
    function copyLink() {
      var url = window.location.href;
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(url).then(function() {
          showToast('é“¾æ¥å·²å¤åˆ¶', 'success');
        });
      } else {
        var textarea = document.createElement('textarea');
        textarea.value = url;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        showToast('é“¾æ¥å·²å¤åˆ¶', 'success');
      }
    }
    
    function loadDocument() {
      var params = new URLSearchParams(window.location.search);
      var docId = params.get('id');
      
      if (!docId) {
        showError();
        return;
      }
      
      fetch(API_URL + '?action=getDocument&data=' + encodeURIComponent(JSON.stringify({ id: docId })))
        .then(function(res) { return res.json(); })
        .then(function(json) {
          if (json.success && json.data) {
            renderDocument(json.data);
          } else {
            showError();
          }
        })
        .catch(function() {
          showError();
        });
    }
    
    function renderDocument(doc) {
      currentDoc = doc;
      
      var typeNames = { prd: 'PRDæ–‡æ¡£', test: 'æµ‹è¯•æŠ¥å‘Š', marketing: 'è¿è¥æ–‡æ¡£', design: 'è®¾è®¡æ–‡æ¡£', custom: 'å…¶ä»–' };
      
      // æ›´æ–°é¡µé¢æ ‡é¢˜
      document.title = doc.title + ' - è›‹å°å¨æ–‡æ¡£';
      
      // æ›´æ–°metaæè¿°
      var metaDesc = document.querySelector('meta[name="description"]');
      if (metaDesc) {
        var desc = doc.content ? doc.content.substring(0, 150).replace(/[#*`\n]/g, '') : 'è›‹å°å¨é¡¹ç›®æ–‡æ¡£';
        metaDesc.setAttribute('content', desc);
      }
      
      // æ¸²æŸ“æ–‡æ¡£
      $('doc-title').textContent = doc.title;
      $('doc-type-badge').textContent = typeNames[doc.type] || 'æ–‡æ¡£';
      $('doc-type-badge').className = 'doc-type-badge ' + doc.type;
      $('doc-date').textContent = 'æ›´æ–°äº ' + new Date(doc.updatedAt).toLocaleDateString();
      $('doc-body').innerHTML = marked.parse(doc.content || '');
      
      // å¦‚æœæœ‰çˆ¶æ–‡ä»¶å¤¹ï¼ŒåŠ è½½å¹¶æ˜¾ç¤º
      if (doc.parentId) {
        fetch(API_URL + '?action=getDocument&data=' + encodeURIComponent(JSON.stringify({ id: doc.parentId })))
          .then(function(res) { return res.json(); })
          .then(function(json) {
            if (json.success && json.data) {
              $('doc-folder').textContent = json.data.title;
              $('doc-folder-item').style.display = 'flex';
            }
          });
      }
      
      // æ·»åŠ çº¯æ–‡æœ¬å†…å®¹ï¼ˆæ–¹ä¾¿AIè¯»å–ï¼‰
      $('plain-text').innerHTML = 
        '<!-- æ–‡æ¡£æ ‡é¢˜: ' + doc.title + ' -->\n' +
        '<!-- æ–‡æ¡£ç±»å‹: ' + (typeNames[doc.type] || 'æ–‡æ¡£') + ' -->\n' +
        '<!-- æ›´æ–°æ—¶é—´: ' + new Date(doc.updatedAt).toLocaleString() + ' -->\n' +
        '<!-- ä»¥ä¸‹æ˜¯æ–‡æ¡£æ­£æ–‡å†…å®¹ -->\n' +
        '<pre style="display:none;">' + escapeHtml(doc.content || '') + '</pre>';
      
      // æ˜¾ç¤ºæ–‡æ¡£
      $('loading').style.display = 'none';
      $('doc-container').style.display = 'block';
    }
    
    function escapeHtml(text) {
      var div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    function showError() {
      $('loading').style.display = 'none';
      $('error').style.display = 'block';
    }
    
    // åˆå§‹åŒ–
    loadDocument();
  </script>
</body>
</html>
