const express = require('express');
const path = require('path');

const app = express();
const PORT = process.env.PORT || 3000;

// PRDæ–‡æ¡£å†…å®¹
const prdContent = `# è›‹å°å¨ äº§å“éœ€æ±‚æ–‡æ¡£ v1.0

## ä¸€ã€äº§å“æ¦‚è¿°

### 1.1 äº§å“åç§°
**è›‹å°å¨** (åŸåï¼šèšé¤ç¥å™¨)

### 1.2 äº§å“å®šä½
ä¸€æ¬¾åŸºäºå¾®ä¿¡å°ç¨‹åºçš„ç¾¤ä½“ç”¨é¤å†³ç­–å·¥å…·ï¼Œé€šè¿‡æŠ•ç¥¨æœºåˆ¶å¸®åŠ©ç”¨æˆ·ç¾¤ä½“å¿«é€Ÿè¾¾æˆç”¨é¤å…±è¯†ã€‚

### 1.3 äº§å“æ„¿æ™¯
**ä¸“æ³¨è§£å†³æ¯å¤©åƒå•¥çš„ä¸–çºªéš¾é¢˜**

### 1.4 ç›®æ ‡ç”¨æˆ·
- å…¬å¸åŒäº‹èšé¤ç‚¹é¤åœºæ™¯
- æœ‹å‹èšä¼šé€‰æ‹©é¤å…/èœå“
- å®¶åº­æˆå‘˜å†³å®šæ—¥å¸¸é¥®é£Ÿ
- ä»»ä½•éœ€è¦ç¾¤ä½“å†³ç­–ã€Œåƒä»€ä¹ˆã€çš„åœºæ™¯

### 1.5 æ ¸å¿ƒä»·å€¼
| ç”¨æˆ·ç—›ç‚¹ | è§£å†³æ–¹æ¡ˆ |
|---------|---------|
| æ¯æ¬¡èšé¤è®¨è®ºåƒä»€ä¹ˆè¦èŠ±å¾ˆé•¿æ—¶é—´ | æŠ•ç¥¨æœºåˆ¶å¿«é€Ÿå†³ç­– |
| ç¾¤é‡Œé—®ä¸€åœˆéƒ½è¯´"éšä¾¿" | å¼ºåˆ¶é€‰æ‹©ï¼Œæ˜ç¡®è¡¨æ€ |
| ä¼—å£éš¾è°ƒï¼Œæ€»æœ‰äººä¸æ»¡æ„ | æ°‘ä¸»æŠ•ç¥¨ï¼Œå°‘æ•°æœä»å¤šæ•° |
| ç»Ÿè®¡å¤§å®¶æƒ³åƒä»€ä¹ˆå¾ˆéº»çƒ¦ | è‡ªåŠ¨ç»Ÿè®¡ï¼Œå®æ—¶ç»“æœ |

---

## äºŒã€åŠŸèƒ½æ¶æ„

### 2.1 æ ¸å¿ƒåŠŸèƒ½
- **åˆ›å»ºæˆ¿é—´**ï¼šè®¾ç½®æˆ¿é—´åç§°ã€æ·»åŠ èœå“ã€é€‰æ‹©é¢„è®¾æ¨¡æ¿
- **æŠ•ç¥¨æœºåˆ¶**ï¼šå¤šé€‰æŠ•ç¥¨ã€å®æ—¶åŒæ­¥ã€æ”¯æŒä¿®æ”¹
- **åˆ†äº«é‚€è¯·**ï¼š6ä½é‚€è¯·ç ã€å¾®ä¿¡åˆ†äº«å¡ç‰‡
- **ç»“æœç»Ÿè®¡**ï¼šå®æ—¶æ’åã€ç¥¨æ•°å±•ç¤º

### 2.2 åŠŸèƒ½è¯´æ˜

#### åˆ›å»ºæˆ¿é—´
- æˆ¿é—´åç§°ï¼šæœ€å¤š20å­—
- èœå•è®¾ç½®ï¼šæ”¯æŒ1-20é“èœå“
- æ¯é“èœå“ï¼šåç§°ã€ä»·æ ¼ã€å¤‡æ³¨ã€å›¾ç‰‡
- é¢„è®¾æ¨¡æ¿ï¼šå·èœã€ç²¤èœã€å®¶å¸¸èœã€è¥¿é¤
- æˆ¿é—´æœ‰æ•ˆæœŸï¼š24å°æ—¶è‡ªåŠ¨è¿‡æœŸ

#### æŠ•ç¥¨æœºåˆ¶
- å¤šé€‰æŠ•ç¥¨ï¼šç”¨æˆ·å¯é€‰æ‹©å¤šé“æƒ³åƒçš„èœ
- å®æ—¶åŒæ­¥ï¼šæŠ•ç¥¨ç»“æœå®æ—¶æ›´æ–°
- ä¿®æ”¹æŠ•ç¥¨ï¼šæŠ•ç¥¨åå¯ä¿®æ”¹é€‰æ‹©

---

## ä¸‰ã€æŠ€æœ¯æ¶æ„

### 3.1 æŠ€æœ¯é€‰å‹
| å±‚çº§ | æŠ€æœ¯æ–¹æ¡ˆ |
|------|---------|
| å‰ç«¯ | å¾®ä¿¡å°ç¨‹åºåŸç”Ÿå¼€å‘ |
| åç«¯ | å¾®ä¿¡äº‘å¼€å‘ï¼ˆäº‘å‡½æ•°ï¼‰ |
| æ•°æ®åº“ | å¾®ä¿¡äº‘æ•°æ®åº“ |
| å­˜å‚¨ | å¾®ä¿¡äº‘å­˜å‚¨ |

### 3.2 æ•°æ®åº“è®¾è®¡

#### rooms é›†åˆ
- _id: æˆ¿é—´ID
- code: 6ä½é‚€è¯·ç 
- name: æˆ¿é—´åç§°
- menu: èœå•åˆ—è¡¨
- members: æˆå‘˜åˆ—è¡¨
- status: active/closed
- createTime: åˆ›å»ºæ—¶é—´
- expireTime: è¿‡æœŸæ—¶é—´

#### votes é›†åˆ
- _id: æŠ•ç¥¨ID
- roomId: æˆ¿é—´ID
- openId: ç”¨æˆ·ID
- selectedDishes: é€‰ä¸­èœå“
- createTime: åˆ›å»ºæ—¶é—´

---

## å››ã€ç‰ˆæœ¬è§„åˆ’

### v1.0ï¼ˆå½“å‰ç‰ˆæœ¬ï¼‰
- [x] åŸºç¡€æŠ•ç¥¨åŠŸèƒ½
- [x] æˆ¿é—´åˆ›å»ºä¸åŠ å…¥
- [x] èœå“å›¾ç‰‡ä¸Šä¼ 
- [x] å®æ—¶æŠ•ç¥¨ç»“æœ

### v1.1ï¼ˆè§„åˆ’ä¸­ï¼‰
- [ ] æˆ¿é—´æœ‰æ•ˆæœŸå»¶é•¿æœºåˆ¶
- [ ] èœå“åˆ†ç±»åŠŸèƒ½
- [ ] æŠ•ç¥¨æ’¤é”€åŠŸèƒ½
- [ ] æ–°æ‰‹å¼•å¯¼

### v2.0ï¼ˆè¿œæœŸè§„åˆ’ï¼‰
- [ ] è®¢é˜…æ¶ˆæ¯é€šçŸ¥
- [ ] å†å²è®°å½•ä¸ç»Ÿè®¡
- [ ] ä¸ªäººå£å‘³åå¥½`;

// æµ‹è¯•æŠ¥å‘Šå†…å®¹
const testContent = `# è›‹å°å¨ v1.0 æµ‹è¯•å¤ç›˜æŠ¥å‘Š

## ä¸€ã€æµ‹è¯•æ¦‚è¿°

### 1.1 æµ‹è¯•èŒƒå›´
- æµ‹è¯•è½®æ¬¡ï¼š10è½®
- æµ‹è¯•æ—¶é—´ï¼š2024å¹´12æœˆ
- æµ‹è¯•ç¯å¢ƒï¼šå¾®ä¿¡å¼€å‘è€…å·¥å…· + çœŸæœºæµ‹è¯•

### 1.2 é—®é¢˜æ±‡æ€»
| ä¼˜å…ˆçº§ | æ•°é‡ | ç±»å‹ |
|--------|------|------|
| P0 | 2ä¸ª | é˜»æ–­ç”¨æˆ·æ ¸å¿ƒæµç¨‹ |
| P1 | 5ä¸ª | ä¸¥é‡å½±å“ä½“éªŒ |
| P2 | 5ä¸ª | å½±å“éƒ¨åˆ†ä½“éªŒ |
| P3 | 3ä¸ª | é”¦ä¸Šæ·»èŠ± |

---

## äºŒã€P0 ä¸¥é‡é—®é¢˜

### é—®é¢˜1ï¼šæˆ¿é—´24å°æ—¶è¿‡æœŸæœºåˆ¶ä¸åˆç†

**é—®é¢˜æè¿°**ï¼š
- æˆ¿é—´åˆ›å»ºåä»…æœ‰24å°æ—¶æœ‰æ•ˆæœŸ
- åˆ›å»ºè€…ç¼–è¾‘çš„èœå•24å°æ—¶åå¤±æ•ˆ
- åˆ†äº«é“¾æ¥è¿‡æœŸåæ–°æˆå‘˜æ— æ³•åŠ å…¥

**ä¿®æ”¹å»ºè®®**ï¼š
- è§‚çœ‹æ¿€åŠ±è§†é¢‘å¯å»¶é•¿24å°æ—¶ï¼ˆæ¯æ—¥é™3æ¬¡ï¼‰
- é‚€è¯·1ä½æ–°ç”¨æˆ·å¯å»¶é•¿48å°æ—¶
- èœå•è‡ªåŠ¨ä¿å­˜ä¸ºã€Œæˆ‘çš„æ¨¡æ¿ã€

### é—®é¢˜2ï¼šã€Œæˆ¿é—´ã€æ¦‚å¿µå¢åŠ ç†è§£é—¨æ§›

**é—®é¢˜æè¿°**ï¼š
- æ ¸å¿ƒåŠŸèƒ½æ˜¯ã€Œåˆ›å»ºèœå•ã€å’Œã€ŒæŠ•ç¥¨é€‰èœã€
- ä½†ç•Œé¢ä½¿ç”¨ã€Œåˆ›å»ºæˆ¿é—´ã€ã€ŒåŠ å…¥æˆ¿é—´ã€è¡¨è¿°
- ã€Œæˆ¿é—´ã€æ˜¯æŠ€æœ¯æ¦‚å¿µï¼Œä¸æ˜¯ç”¨æˆ·å¿ƒæ™º

**ä¿®æ”¹å»ºè®®**ï¼š
- ã€Œåˆ›å»ºæˆ¿é—´ã€â†’ã€Œå‘èµ·ç‚¹é¤ã€
- ã€ŒåŠ å…¥æˆ¿é—´ã€â†’ã€Œå‚ä¸æŠ•ç¥¨ã€
- ã€Œæˆ‘çš„æˆ¿é—´ã€â†’ã€Œæˆ‘çš„ç‚¹é¤ã€

---

## ä¸‰ã€P1 é‡è¦é—®é¢˜

### é—®é¢˜3ï¼šè¿‡æœŸæˆ¿é—´ä½“éªŒæ–­è£‚
- ç”¨æˆ·è¿›å…¥å·²è¿‡æœŸæˆ¿é—´ä»…æ˜¾ç¤ºã€Œå·²ç»“æŸã€
- å»ºè®®æ˜¾ç¤ºå¼•å¯¼é¡µé¢å’Œæ“ä½œé€‰é¡¹

### é—®é¢˜4ï¼šæŠ•ç¥¨åæ— æ³•æ’¤é”€
- æ— æ³•å¼ƒæƒæˆ–å–æ¶ˆæŠ•ç¥¨
- å»ºè®®æ·»åŠ ã€Œæ’¤é”€æŠ•ç¥¨ã€åŠŸèƒ½

### é—®é¢˜5ï¼šåˆ›å»ºèœå•æ— æ³•é¢„è§ˆ
- åˆ›å»ºæ—¶æ— æ³•é¢„è§ˆæŠ•ç¥¨ç•Œé¢æ•ˆæœ
- å»ºè®®æ·»åŠ ã€Œé¢„è§ˆã€æŒ‰é’®

### é—®é¢˜6ï¼šæŠ•ç¥¨ç»“æœç¼ºä¹æ•°æ®
- æ— æŠ•ç¥¨å‚ä¸ç‡ã€æœªæŠ•ç¥¨åå•
- å»ºè®®æ˜¾ç¤ºå‚ä¸ç‡å’Œå‚¬ä¿ƒåŠŸèƒ½

### é—®é¢˜7ï¼šå›¾ç‰‡åŠ è½½ä½“éªŒå·®
- åŠ è½½æ…¢ã€æ— å ä½å›¾ã€å¸ƒå±€è·³åŠ¨
- å»ºè®®æ‡’åŠ è½½+éª¨æ¶å±

---

## å››ã€P2 ä¸€èˆ¬é—®é¢˜

- é—®é¢˜8ï¼šæ— æ³•å¯¹èœå“åˆ†ç±»
- é—®é¢˜9ï¼šåˆ†äº«å¡ç‰‡ä¿¡æ¯å°‘
- é—®é¢˜10ï¼šç¼ºå°‘æ–°æ‰‹å¼•å¯¼
- é—®é¢˜11ï¼šæ— å†å²æŠ•ç¥¨è®°å½•
- é—®é¢˜12ï¼šé‚€è¯·ç è¾“å…¥ä½“éªŒå·®

---

## äº”ã€P3 ä¼˜åŒ–å»ºè®®

- é—®é¢˜13ï¼šç¼ºå°‘æ¶ˆæ¯é€šçŸ¥
- é—®é¢˜14ï¼šç¼ºå°‘æ•°æ®ç»Ÿè®¡
- é—®é¢˜15ï¼šç•Œé¢ä¸ªæ€§åŒ–ä¸è¶³

---

## å…­ã€ä¿®å¤ä¼˜å…ˆçº§

### ç¬¬ä¸€ä¼˜å…ˆçº§ï¼ˆæœ¬å‘¨ï¼‰
- P0-1ï¼šæˆ¿é—´æœ‰æ•ˆæœŸä¼˜åŒ–
- P0-2ï¼šæœ¯è¯­æ”¹ä¸ºç›´è§‚è¡¨è¿°

### ç¬¬äºŒä¼˜å…ˆçº§ï¼ˆä¸‹ç‰ˆæœ¬ï¼‰
- P1ç³»åˆ—é—®é¢˜

### ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼ˆåç»­ï¼‰
- P2/P3ç³»åˆ—é—®é¢˜`;

// è¿è¥æ‰‹å†Œå†…å®¹
const marketingContent = `# è›‹å°å¨ è¿è¥æ¨å¹¿æ‰‹å†Œ

## ä¸€ã€äº§å“æ ¸å¿ƒå–ç‚¹

### ä¸€å¥è¯ä»‹ç»
> **è›‹å°å¨ â€”â€” ä¸“æ³¨è§£å†³æ¯å¤©åƒå•¥çš„ä¸–çºªéš¾é¢˜**

### æ ¸å¿ƒåŠŸèƒ½ä»·å€¼
| åŠŸèƒ½ | ç”¨æˆ·ä»·å€¼ |
|------|---------|
| ç¾¤ä½“æŠ•ç¥¨ç‚¹é¤ | å‘Šåˆ«é€‰æ‹©å›°éš¾ï¼Œæ°‘ä¸»å†³å®š |
| ä¸€é”®åˆ›å»ºæˆ¿é—´ | 3ç§’åˆ›å»ºï¼Œåˆ†äº«å³å¯å‚ä¸ |
| å®æ—¶æŠ•ç¥¨ç»“æœ | è°æƒ³åƒä»€ä¹ˆä¸€ç›®äº†ç„¶ |
| èœå“å›¾ç‰‡å±•ç¤º | çœ‹å›¾é€‰èœï¼Œæ›´æœ‰é£Ÿæ¬² |

---

## äºŒã€ç›®æ ‡ç”¨æˆ·ç”»åƒ

### æ ¸å¿ƒåœºæ™¯
| åœºæ™¯ | ç—›ç‚¹æè¿° |
|------|---------|
| å…¬å¸åŒäº‹èšé¤ | 10ä¸ªäºº10ä¸ªæ„è§ï¼ŒåµåŠå¤©å®šä¸ä¸‹æ¥ |
| æœ‹å‹å‘¨æœ«çº¦é¥­ | æ¯æ¬¡éƒ½æ˜¯ã€Œéšä¾¿ã€ã€Œéƒ½è¡Œã€ |
| å®¶åº­æ—¥å¸¸ç‚¹é¤ | å›ç­”ã€Œéšä¾¿ã€å°±æ˜¯æ‰¾æ­» |
| éƒ¨é—¨å›¢å»ºç‚¹é¤ | ç»Ÿè®¡åˆ°å´©æºƒ |

### ç”¨æˆ·æ ‡ç­¾
- å¹´é¾„ï¼š22-40å²èŒåœºäººç¾¤
- ç‰¹å¾ï¼šç¤¾äº¤æ´»è·ƒï¼Œç»å¸¸èšé¤
- ç—›ç‚¹ï¼šé€‰æ‹©å›°éš¾ç—‡
- ä¹ æƒ¯ï¼šå¾®ä¿¡é‡åº¦ç”¨æˆ·

---

## ä¸‰ã€å¾®ä¿¡æœ‹å‹åœˆæ–‡æ¡ˆ

### æ–‡æ¡ˆ1ï¼šç—›ç‚¹å…±é¸£
ã€Œä»Šå¤©åƒå•¥ï¼Ÿã€ã€Œéšä¾¿ã€ã€Œé‚£ç«é”…ï¼Ÿã€ã€Œä¸æƒ³åƒè¾£ã€â€¦â€¦ å®‰åˆ©ä¸€ä¸ªç¥å™¨ï¼šè›‹å°å¨ï¼Œåˆ›å»ºæŠ•ç¥¨æˆ¿é—´ï¼Œè®©å¤§å®¶è‡ªå·±é€‰ï¼å¾®ä¿¡æœã€Œè›‹å°å¨ã€

### æ–‡æ¡ˆ2ï¼šåœºæ™¯ä»£å…¥
å…¬å¸10ä¸ªäººèšé¤ï¼Œé—®äº†ä¸€åœˆæ¯ä¸ªäººéƒ½è¯´ã€Œéšä¾¿ã€ï¼Œæœ€åç‚¹çš„èœæ²¡ä¸€ä¸ªäººæ»¡æ„ã€‚åæ¥å‘ç°è¿™ä¸ªå°ç¨‹åºï¼Œ2åˆ†é’Ÿæå®šï¼

### æ–‡æ¡ˆ3ï¼šè½»æ¾è°ƒä¾ƒ
è‡ªä»ç”¨äº†è›‹å°å¨ï¼Œæˆ‘ä»¬éƒ¨é—¨çš„èšé¤æ•ˆç‡æå‡äº†300%ï¼Œåµæ¶ç‡ä¸‹é™äº†99%

---

## å››ã€å¾®ä¿¡ç¾¤åˆ†äº«æ–‡æ¡ˆ

### å‘èµ·æŠ•ç¥¨æ—¶
@æ‰€æœ‰äºº å‘¨äº”èšé¤æŠ•ç¥¨å¼€å§‹å•¦ï¼
æˆ‘å·²ç»åœ¨ã€Œè›‹å°å¨ã€åˆ›å»ºäº†æŠ•ç¥¨æˆ¿é—´
ğŸ‘‰ é‚€è¯·ç ï¼šXXXXXX
è¯·å¤§å®¶è¿›å°ç¨‹åºæŠ•ç¥¨é€‰æ‹©æƒ³åƒçš„èœï½

### å‚¬ä¿ƒæŠ•ç¥¨
è¿˜æœ‰3ä¸ªäººæ²¡æŠ•ç¥¨å‘¢ï¼
å¿«è¿›è›‹å°å¨æŠ•ç¥¨ï¼Œé‚€è¯·ç  XXXXXX
å†ä¸æŠ•å°±æŒ‰å¼ƒæƒå¤„ç† ğŸ˜

### å…¬å¸ƒç»“æœ
æŠ•ç¥¨ç»“æœå‡ºç‚‰ï¼
ğŸ¥‡ çº¢çƒ§è‚‰ - 8ç¥¨
ğŸ¥ˆ ç³–é†‹æ’éª¨ - 6ç¥¨
ğŸ¥‰ æ¸…è’¸é²ˆé±¼ - 5ç¥¨
ä»Šæ™šå°±åƒè¿™ä¸‰é“èœï½

---

## äº”ã€å°çº¢ä¹¦ç§è‰æ–‡æ¡ˆ

### æ ‡é¢˜
æ•‘å‘½ï¼è¿™ä¸ªå°ç¨‹åºè§£å†³äº†æˆ‘å¤šå¹´çš„é€‰æ‹©å›°éš¾ç—‡ï¼ï¼

### æ­£æ–‡
å§å¦¹ä»¬ï¼ä»Šå¤©å¿…é¡»å®‰åˆ©è¿™ä¸ªå®è—å°ç¨‹åº â€”â€”ã€Œè›‹å°å¨ã€

ä¸Šå‘¨å…¬å¸èšé¤ï¼Œ10ä¸ªäººåœ¨ç¾¤é‡Œè®¨è®ºäº†2å°æ—¶éƒ½æ²¡å®šä¸‹æ¥åƒå•¥

åæ¥åŒäº‹åˆ†äº«äº†è¿™ä¸ªå°ç¨‹åºï¼Œ3åˆ†é’Ÿå°±å‡ºç»“æœäº†ï¼ï¼

âœ¨ äº®ç‚¹åŠŸèƒ½ï¼š
â€¢ å¯ä»¥ä¸Šä¼ èœå“å›¾ç‰‡
â€¢ å®æ—¶çœ‹åˆ°è°æŠ•äº†ä»€ä¹ˆ
â€¢ è¿˜èƒ½ä¿®æ”¹æŠ•ç¥¨

å¾®ä¿¡ç›´æ¥æœã€Œè›‹å°å¨ã€å°±èƒ½ç”¨ï½

#é€‰æ‹©å›°éš¾ç—‡ #èšé¤ç¥å™¨ #å¾®ä¿¡å°ç¨‹åºæ¨è

---

## å…­ã€èŠ‚æ—¥è¥é”€æ–‡æ¡ˆ

| èŠ‚æ—¥ | æ–‡æ¡ˆ |
|------|------|
| æ˜¥èŠ‚ | å¹´å¤œé¥­åƒä»€ä¹ˆï¼Ÿç”¨è›‹å°å¨æŠ•ç¥¨ï¼Œè®©æ•°æ®è¯´è¯ï¼ |
| æƒ…äººèŠ‚ | çº¦ä¼šåƒä»€ä¹ˆï¼Ÿåˆ«è®©ã€Œéšä¾¿ã€æ¯æ‰æµªæ¼«ï½ |
| ä¸­ç§‹ | å›¢åœ†é¥­èœå•éš¾å®šï¼Ÿå®¶åº­ç¾¤æŠ•ç¥¨èµ°èµ·ï¼ |
| åœ£è¯ | Christmas Party åƒä»€ä¹ˆï¼ŸæŠ•ç¥¨å†³å®šï¼ |`;

// æŠ€æœ¯æ–‡æ¡£å†…å®¹
const techContent = `# è›‹å°å¨ æŠ€æœ¯å¼€å‘æ–‡æ¡£

## ä¸€ã€é¡¹ç›®ç»“æ„

jcsq/
â”œâ”€â”€ cloudfunctions/     # äº‘å‡½æ•°
â”‚   â”œâ”€â”€ createRoom/     # åˆ›å»ºæˆ¿é—´
â”‚   â”œâ”€â”€ joinRoom/       # åŠ å…¥æˆ¿é—´
â”‚   â”œâ”€â”€ getRoomDetail/  # è·å–æˆ¿é—´è¯¦æƒ…
â”‚   â”œâ”€â”€ submitVote/     # æäº¤æŠ•ç¥¨
â”‚   â””â”€â”€ getVoteResults/ # è·å–æŠ•ç¥¨ç»“æœ
â”œâ”€â”€ miniprogram/
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ index/      # é¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ create/     # åˆ›å»ºæˆ¿é—´
â”‚   â”‚   â””â”€â”€ room/       # æˆ¿é—´è¯¦æƒ…
â”‚   â”œâ”€â”€ images/         # å›¾ç‰‡èµ„æº
â”‚   â””â”€â”€ utils/          # å·¥å…·å‡½æ•°
â””â”€â”€ project.config.json

---

## äºŒã€äº‘å‡½æ•°è¯´æ˜

### createRoom - åˆ›å»ºæˆ¿é—´

**å‚æ•°**ï¼š
- roomName: string - æˆ¿é—´åç§°
- menu: Array - èœå•åˆ—è¡¨

**è¿”å›**ï¼š
- success: boolean
- code: string - 6ä½é‚€è¯·ç 
- roomId: string - æˆ¿é—´ID

**é‚€è¯·ç è§„åˆ™**ï¼š
- 6ä½å­—æ¯+æ•°å­—ç»„åˆ
- æ’é™¤æ˜“æ··æ·†å­—ç¬¦ï¼ˆ0/O, 1/I/Lï¼‰

### joinRoom - åŠ å…¥æˆ¿é—´

**å‚æ•°**ï¼š
- code: string - é‚€è¯·ç 
- userInfo: object - ç”¨æˆ·ä¿¡æ¯

### submitVote - æäº¤æŠ•ç¥¨

**å‚æ•°**ï¼š
- roomId: string
- selectedDishes: Array - é€‰ä¸­èœå“ID

---

## ä¸‰ã€æ•°æ®åº“ç´¢å¼•

### rooms é›†åˆ
| å­—æ®µ | ç´¢å¼•ç±»å‹ | è¯´æ˜ |
|------|---------|------|
| code | å”¯ä¸€ç´¢å¼• | é‚€è¯·ç æŸ¥è¯¢ |
| creatorOpenId | æ™®é€šç´¢å¼• | æˆ‘çš„æˆ¿é—´ |
| expireTime | æ™®é€šç´¢å¼• | è¿‡æœŸæ¸…ç† |

### votes é›†åˆ
| å­—æ®µ | ç´¢å¼•ç±»å‹ | è¯´æ˜ |
|------|---------|------|
| roomId | æ™®é€šç´¢å¼• | æˆ¿é—´æŠ•ç¥¨æŸ¥è¯¢ |
| openId | æ™®é€šç´¢å¼• | ç”¨æˆ·æŠ•ç¥¨æŸ¥è¯¢ |

---

## å››ã€å›¾ç‰‡å¤„ç†

### ä¸Šä¼ æµç¨‹
1. ç”¨æˆ·é€‰æ‹©å›¾ç‰‡
2. å‰ç«¯å‹ç¼©ï¼ˆcanvaså‹ç¼©è‡³1MBä»¥å†…ï¼‰
3. ç”Ÿæˆç¼©ç•¥å›¾ï¼ˆ200x200ï¼‰
4. ä¸Šä¼ è‡³äº‘å­˜å‚¨

### å‹ç¼©å‚æ•°
- maxWidth: 1080
- maxHeight: 1080
- quality: 0.8
- thumbSize: 200

---

## äº”ã€å·²çŸ¥é—®é¢˜

### å¾®ä¿¡å¤´åƒæ˜µç§°é—®é¢˜
2021å¹´4æœˆèµ·ï¼Œwx.getUserProfile è¿”å›å›ºå®šå€¼

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨å®˜æ–¹ã€Œå¤´åƒæ˜µç§°å¡«å†™èƒ½åŠ›ã€
- button open-type="chooseAvatar"
- input type="nickname"`;

// ç‰ˆæœ¬æ—¥å¿—å†…å®¹
const changelogContent = `# è›‹å°å¨ ç‰ˆæœ¬æ›´æ–°æ—¥å¿—

## v1.0.3 (2024-12-24)

### Bug ä¿®å¤
- ä¿®å¤å¤´åƒæ˜µç§°æ˜¾ç¤ºä¸ºã€Œå¾®ä¿¡ç”¨æˆ·ã€çš„é—®é¢˜
- é€‚é…å¾®ä¿¡éšç§æ”¿ç­–ï¼Œæ”¹ç”¨å®˜æ–¹å¤´åƒæ˜µç§°å¡«å†™èƒ½åŠ›
- ä¿®å¤ç”¨æˆ·å–æ¶ˆé€‰æ‹©å¤´åƒæ—¶çš„æŠ¥é”™

### ä¼˜åŒ–
- æ–°ç”¨æˆ·ç™»å½•åè‡ªåŠ¨å¼¹å‡ºèµ„æ–™å¡«å†™å¼¹çª—
- è€ç”¨æˆ·å¦‚æœªè®¾ç½®æ˜µç§°ä¹Ÿä¼šæç¤ºå®Œå–„ä¿¡æ¯

---

## v1.0.2 (2024-12-23)

### Bug ä¿®å¤
- ä¿®å¤åˆ†äº«é“¾æ¥è¿›å…¥åè‡ªåŠ¨åŠ å…¥æˆ¿é—´çš„é—®é¢˜
- ç°åœ¨æ”¹ä¸ºæ˜¾ç¤ºç¡®è®¤å¼¹çª—

### ä¼˜åŒ–
- ä¼˜åŒ–å€’è®¡æ—¶æ˜¾ç¤ºé€»è¾‘
- åˆ†äº«å¡ç‰‡æ ‡é¢˜æ˜¾ç¤ºæˆ¿é—´åç§°

---

## v1.0.1 (2024-12-22)

### å“ç‰Œå‡çº§
- äº§å“æ›´åï¼šèšé¤ç¥å™¨ â†’ è›‹å°å¨
- å…¨æ–° Logo è®¾è®¡
- æ›´æ–° Slogan

### ä¼˜åŒ–
- é¦–é¡µå¢åŠ æ°”æ³¡æç¤ºå¼•å¯¼
- ä¼˜åŒ–ç™»å½•æµç¨‹ï¼Œæ”¯æŒæ¸¸å®¢æµè§ˆ

---

## v1.0.0 (2024-12-20)

### é¦–æ¬¡å‘å¸ƒ

**æ ¸å¿ƒåŠŸèƒ½**
- åˆ›å»ºæŠ•ç¥¨æˆ¿é—´
- æ·»åŠ èœå“
- 6ä½é‚€è¯·ç åˆ†äº«
- å¤šé€‰æŠ•ç¥¨
- å®æ—¶ç»“æœç»Ÿè®¡

**é¢„è®¾æ¨¡æ¿**
- å·èœã€ç²¤èœã€å®¶å¸¸èœã€è¥¿é¤

---

## è§„åˆ’ä¸­åŠŸèƒ½

### v1.1 (é¢„è®¡1æœˆ)
- æˆ¿é—´æœ‰æ•ˆæœŸå»¶é•¿
- èœå“åˆ†ç±»åŠŸèƒ½
- æŠ•ç¥¨æ’¤é”€åŠŸèƒ½

### v2.0 (é¢„è®¡3æœˆ)
- è®¢é˜…æ¶ˆæ¯é€šçŸ¥
- å†å²è®°å½•ä¸ç»Ÿè®¡
- æˆ‘çš„æ¨¡æ¿`;

// å®Œæ•´æ–‡æ¡£æ•°æ®
let appData = {
  documents: [
    {
      _id: 'doc_1',
      title: 'è›‹å°å¨ PRD v1.0',
      type: 'prd',
      content: prdContent,
      createdAt: 1703145600000,
      updatedAt: 1703318400000
    },
    {
      _id: 'doc_2',
      title: 'æµ‹è¯•å¤ç›˜æŠ¥å‘Š v1.0',
      type: 'test',
      content: testContent,
      createdAt: 1703318400000,
      updatedAt: 1703318400000
    },
    {
      _id: 'doc_3',
      title: 'è¿è¥æ¨å¹¿æ‰‹å†Œ',
      type: 'marketing',
      content: marketingContent,
      createdAt: 1703318400000,
      updatedAt: 1703318400000
    },
    {
      _id: 'doc_4',
      title: 'æŠ€æœ¯å¼€å‘æ–‡æ¡£',
      type: 'design',
      content: techContent,
      createdAt: 1703232000000,
      updatedAt: 1703318400000
    },
    {
      _id: 'doc_5',
      title: 'ç‰ˆæœ¬æ›´æ–°æ—¥å¿—',
      type: 'custom',
      content: changelogContent,
      createdAt: 1703145600000,
      updatedAt: 1703318400000
    }
  ],
  issues: [
    { _id: 'issue_1', title: 'æˆ¿é—´24å°æ—¶è¿‡æœŸæœºåˆ¶ä¸åˆç†', priority: 'p0', status: 'open', createdAt: Date.now() },
    { _id: 'issue_2', title: 'ã€Œæˆ¿é—´ã€æ¦‚å¿µå¢åŠ ç”¨æˆ·ç†è§£é—¨æ§›', priority: 'p0', status: 'open', createdAt: Date.now() },
    { _id: 'issue_3', title: 'è¿‡æœŸæˆ¿é—´ä½“éªŒæ–­è£‚', priority: 'p1', status: 'open', createdAt: Date.now() },
    { _id: 'issue_4', title: 'æŠ•ç¥¨åæ— æ³•æ’¤é”€', priority: 'p1', status: 'open', createdAt: Date.now() },
    { _id: 'issue_5', title: 'åˆ›å»ºèœå•æ—¶æ— æ³•é¢„è§ˆ', priority: 'p1', status: 'open', createdAt: Date.now() },
    { _id: 'issue_6', title: 'æŠ•ç¥¨ç»“æœç¼ºä¹æ•°æ®æ´å¯Ÿ', priority: 'p1', status: 'open', createdAt: Date.now() },
    { _id: 'issue_7', title: 'èœå“å›¾ç‰‡åŠ è½½ä½“éªŒå·®', priority: 'p1', status: 'open', createdAt: Date.now() },
    { _id: 'issue_8', title: 'æ— æ³•å¯¹èœå“è¿›è¡Œåˆ†ç±»', priority: 'p2', status: 'open', createdAt: Date.now() },
    { _id: 'issue_9', title: 'åˆ†äº«å¡ç‰‡ä¿¡æ¯ä¸å¤Ÿä¸°å¯Œ', priority: 'p2', status: 'open', createdAt: Date.now() },
    { _id: 'issue_10', title: 'ç¼ºå°‘æ–°æ‰‹å¼•å¯¼', priority: 'p2', status: 'open', createdAt: Date.now() },
    { _id: 'issue_11', title: 'æ— æ³•æŸ¥çœ‹å†å²æŠ•ç¥¨è®°å½•', priority: 'p2', status: 'open', createdAt: Date.now() },
    { _id: 'issue_12', title: 'é‚€è¯·ç è¾“å…¥ä½“éªŒä¸ä½³', priority: 'p2', status: 'open', createdAt: Date.now() },
    { _id: 'issue_13', title: 'ç¼ºå°‘æ¶ˆæ¯é€šçŸ¥æœºåˆ¶', priority: 'p3', status: 'open', createdAt: Date.now() },
    { _id: 'issue_14', title: 'ç¼ºå°‘æ•°æ®ç»Ÿè®¡åŠŸèƒ½', priority: 'p3', status: 'open', createdAt: Date.now() },
    { _id: 'issue_15', title: 'ç•Œé¢ä¸ªæ€§åŒ–ä¸è¶³', priority: 'p3', status: 'open', createdAt: Date.now() }
  ],
  changelog: [
    { _id: 'log_1', date: '2024-12-25', content: 'éƒ¨ç½²é¡¹ç›®æ–‡æ¡£ä¸­å¿ƒåˆ° Vercel', createdAt: Date.now() },
    { _id: 'log_2', date: '2024-12-24', content: 'å®Œæˆv1.0æµ‹è¯•å¤ç›˜ï¼Œå‘ç°15ä¸ªé—®é¢˜', createdAt: Date.now() },
    { _id: 'log_3', date: '2024-12-24', content: 'ç”Ÿæˆè¿è¥æ¨å¹¿æ‰‹å†Œ', createdAt: Date.now() },
    { _id: 'log_4', date: '2024-12-24', content: 'ç”ŸæˆPRDäº§å“éœ€æ±‚æ–‡æ¡£v1.0', createdAt: Date.now() },
    { _id: 'log_5', date: '2024-12-23', content: 'ä¿®å¤å¤´åƒæ˜µç§°æ˜¾ç¤ºé—®é¢˜', createdAt: Date.now() },
    { _id: 'log_6', date: '2024-12-22', content: 'å®Œæˆå“ç‰Œå‡çº§ï¼Œæ›´åä¸ºã€Œè›‹å°å¨ã€', createdAt: Date.now() },
    { _id: 'log_7', date: '2024-12-20', content: 'é¡¹ç›®å¯åŠ¨ï¼Œå®Œæˆv1.0æ ¸å¿ƒåŠŸèƒ½å¼€å‘', createdAt: Date.now() }
  ]
};

// ç”Ÿæˆå”¯ä¸€ID
const genId = (prefix) => prefix + '_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);

// ä¸­é—´ä»¶
app.use(express.json());
app.use(express.static(path.join(__dirname, 'public')));

// CORS
app.use((req, res, next) => {
  res.header('Access-Control-Allow-Origin', '*');
  res.header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');
  res.header('Access-Control-Allow-Headers', 'Content-Type');
  if (req.method === 'OPTIONS') return res.sendStatus(200);
  next();
});

// ==================== æ–‡æ¡£ API ====================

app.get('/api/documents', (req, res) => {
  const docs = appData.documents.sort((a, b) => b.updatedAt - a.updatedAt);
  res.json({ success: true, data: docs });
});

app.get('/api/documents/:id', (req, res) => {
  const doc = appData.documents.find(d => d._id === req.params.id);
  if (!doc) return res.status(404).json({ success: false, error: 'æ–‡æ¡£ä¸å­˜åœ¨' });
  res.json({ success: true, data: doc });
});

app.post('/api/documents', (req, res) => {
  const { title, type, content } = req.body;
  const now = Date.now();
  const doc = {
    _id: genId('doc'),
    title: title,
    type: type || 'custom',
    content: content || '',
    createdAt: now,
    updatedAt: now
  };
  appData.documents.push(doc);
  res.json({ success: true, id: doc._id });
});

app.put('/api/documents/:id', (req, res) => {
  const doc = appData.documents.find(d => d._id === req.params.id);
  if (!doc) return res.status(404).json({ success: false, error: 'æ–‡æ¡£ä¸å­˜åœ¨' });
  
  const { title, type, content } = req.body;
  if (title) doc.title = title;
  if (type) doc.type = type;
  if (content !== undefined) doc.content = content;
  doc.updatedAt = Date.now();
  
  res.json({ success: true });
});

app.delete('/api/documents/:id', (req, res) => {
  const index = appData.documents.findIndex(d => d._id === req.params.id);
  if (index === -1) return res.status(404).json({ success: false, error: 'æ–‡æ¡£ä¸å­˜åœ¨' });
  appData.documents.splice(index, 1);
  res.json({ success: true });
});

// ==================== é—®é¢˜ API ====================

app.get('/api/issues', (req, res) => {
  const issues = appData.issues.sort((a, b) => {
    const priorityOrder = { p0: 0, p1: 1, p2: 2, p3: 3 };
    return priorityOrder[a.priority] - priorityOrder[b.priority];
  });
  res.json({ success: true, data: issues });
});

app.post('/api/issues', (req, res) => {
  const { title, priority, description } = req.body;
  const issue = {
    _id: genId('issue'),
    title: title,
    priority: priority || 'p2',
    description: description || '',
    status: 'open',
    createdAt: Date.now()
  };
  appData.issues.push(issue);
  res.json({ success: true, id: issue._id });
});

app.put('/api/issues/:id', (req, res) => {
  const issue = appData.issues.find(i => i._id === req.params.id);
  if (!issue) return res.status(404).json({ success: false, error: 'é—®é¢˜ä¸å­˜åœ¨' });
  
  const { status, title, priority, description } = req.body;
  if (status) issue.status = status;
  if (title) issue.title = title;
  if (priority) issue.priority = priority;
  if (description !== undefined) issue.description = description;
  issue.updatedAt = Date.now();
  
  res.json({ success: true });
});

app.delete('/api/issues/:id', (req, res) => {
  const index = appData.issues.findIndex(i => i._id === req.params.id);
  if (index === -1) return res.status(404).json({ success: false, error: 'é—®é¢˜ä¸å­˜åœ¨' });
  appData.issues.splice(index, 1);
  res.json({ success: true });
});

// ==================== æ›´æ–°æ—¥å¿— API ====================

app.get('/api/changelog', (req, res) => {
  const logs = appData.changelog.sort((a, b) => new Date(b.date) - new Date(a.date));
  res.json({ success: true, data: logs });
});

app.post('/api/changelog', (req, res) => {
  const { content, date } = req.body;
  const log = {
    _id: genId('log'),
    content: content,
    date: date || new Date().toISOString().split('T')[0],
    createdAt: Date.now()
  };
  appData.changelog.push(log);
  res.json({ success: true, id: log._id });
});

app.delete('/api/changelog/:id', (req, res) => {
  const index = appData.changelog.findIndex(l => l._id === req.params.id);
  if (index === -1) return res.status(404).json({ success: false, error: 'è®°å½•ä¸å­˜åœ¨' });
  appData.changelog.splice(index, 1);
  res.json({ success: true });
});

// ==================== ç»Ÿè®¡ API ====================

app.get('/api/stats', (req, res) => {
  const openIssues = appData.issues.filter(i => i.status !== 'done').length;
  const doneIssues = appData.issues.filter(i => i.status === 'done').length;
  const total = appData.issues.length;
  
  res.json({
    success: true,
    data: {
      totalDocs: appData.documents.length,
      totalIssues: total,
      openIssues: openIssues,
      doneIssues: doneIssues,
      progress: total > 0 ? Math.round(doneIssues / total * 100) : 0
    }
  });
});

// åˆå§‹åŒ–
app.post('/api/init', (req, res) => {
  res.json({ success: true, message: 'æ•°æ®å·²å°±ç»ª' });
});

// å¥åº·æ£€æŸ¥
app.get('/health', (req, res) => {
  res.json({ status: 'ok', timestamp: new Date().toISOString() });
});

// é¦–é¡µ
app.get('/', (req, res) => {
  res.sendFile(path.join(__dirname, 'public', 'index.html'));
});

// å¯åŠ¨æœåŠ¡
if (require.main === module) {
  app.listen(PORT, function() {
    console.log('æœåŠ¡å·²å¯åŠ¨: http://localhost:' + PORT);
  });
}

module.exports = app;
